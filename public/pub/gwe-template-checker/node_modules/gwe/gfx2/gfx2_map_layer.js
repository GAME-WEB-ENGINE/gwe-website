let { Gfx2Drawable } = require('./gfx2_drawable');
let { gfx2Manager } = require('./gfx2_manager');

class Gfx2MapLayer extends Gfx2Drawable {
  constructor(map, layerIndex) {
    super();
    this.map = map;
    this.layerIndex = layerIndex;
  }

  paint(ts) {
    let ctx = gfx2Manager.getContext();
    let layer = this.map.getTileLayer(this.layerIndex);
    let tileset = this.map.getTileset();

    if (!layer) {
      return;
    }
    if (!layer.isVisible()) {
      return;
    }

    for (let i = 0; i < layer.getTileCount(); i++) {
      let texTilePosition = tileset.getTilePosition(layer.getTile(i));
      let texTileWidth = tileset.getTileWidth();
      let texTileHeight = tileset.getTileHeight();
      let location = layer.getLocationAt(i);
      let x = Math.round(location[0] * this.map.getTileWidth());
      let y = Math.round(location[1] * this.map.getTileHeight());
      ctx.drawImage(tileset.getTexture(), texTilePosition[0], texTilePosition[1], texTileWidth, texTileHeight, x, y, this.map.getTileWidth(), this.map.getTileHeight());
    }
  }
}

module.exports.Gfx2MapLayer = Gfx2MapLayer;